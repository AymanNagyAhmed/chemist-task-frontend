(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{5762:function(e,r,a){Promise.resolve().then(a.bind(a,6172))},6172:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return p}});var t=a(7437),s=a(2265),l=a(9376),i=a(1229);let o="http://localhost:4000/api",n=async()=>{try{let e=await fetch("".concat(o,"/preferred-locations"));if(!e.ok)throw Error("Failed to fetch locations");let r=await e.json();if(!r.success)throw Error(r.message);return r.data}catch(e){return console.error("Error fetching locations:",e),[{id:1,locationName:"Remote"}]}},m=async()=>{try{let e=await fetch("".concat(o,"/programming-skills"));if(!e.ok)throw Error("Failed to fetch programming skills");let r=await e.json();if(!r.success)throw Error(r.message);return r.data}catch(e){return console.error("Error fetching programming skills:",e),[{id:1,name:"JavaScript"}]}};var c=a(4131);class d extends Error{constructor(e,r,a){super(e),this.status=r,this.path=a,this.name="UserApiError"}}let u=async(e,r)=>{let a=c.Z.get("access_token");if(!a)throw new d("Not authenticated",401,"/api/users");try{let t=new FormData;t.append("fullName",r.fullName),t.append("dateOfBirth",r.dateOfBirth),t.append("resumeSummary",r.resumeSummary),t.append("preferredLocationId",r.preferredLocationId.toString()),t.append("programmingSkills",JSON.stringify(r.programmingSkills)),r.profileImage&&t.append("profileImage",r.profileImage);let s=await fetch("".concat("http://localhost:4000/api","/users/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a)},body:t,credentials:"include"}),l=await s.json();if(!s.ok)throw new d(l.message,l.statusCode,l.path);return l.success&&(c.Z.set("user_data",JSON.stringify(l.data),{secure:!0,sameSite:"strict",path:"/"}),c.Z.set("userRegistered","true",{secure:!0,sameSite:"strict",path:"/"})),l}catch(e){if(console.error("Error in updateUserProfile:",e),e instanceof d)throw e;throw new d("Network error",500,"/api/users")}},f=(e,r)=>i.z.object({fullName:i.z.string().min(2,"Full name must be at least 2 characters"),dateOfBirth:i.z.string().refine(e=>new Date().getFullYear()-new Date(e).getFullYear()>=18,"You must be at least 18 years old"),resumeSummary:i.z.string().min(5,"Resume summary must be at least 5 characters"),preferredLocationId:i.z.number().min(1,"Please select a location"),programmingSkills:i.z.array(i.z.number()).min(1,"Select at least one skill")}),g=e=>e?new Date(e).toISOString().split("T")[0]:"";function p(){let e=(0,l.useRouter)(),[r,a]=(0,s.useState)(!1),o=(()=>{try{let t=c.Z.get("user_data");if(t){var e,r,a;let s=JSON.parse(t),l=null===(e=s.preferredLocation)||void 0===e?void 0:e.id;return{fullName:null!==(r=s.fullName)&&void 0!==r?r:"",dateOfBirth:s.dateOfBirth?g(s.dateOfBirth):"",resumeSummary:null!==(a=s.resumeSummary)&&void 0!==a?a:"",preferredLocationId:l?Number(l):0,programmingSkills:Array.isArray(s.programmingSkills)?s.programmingSkills.map(e=>Number(e.id)):[]}}}catch(e){console.error("Error parsing initial user data:",e)}return{fullName:"",dateOfBirth:"",resumeSummary:"",preferredLocationId:0,programmingSkills:[]}})(),[p,h]=(0,s.useState)(!1),[x,b]=(0,s.useState)({}),[y,N]=(0,s.useState)([]),[S,j]=(0,s.useState)([]),[w,k]=(0,s.useState)(o),[v,I]=(0,s.useState)(!0),O=c.Z.get("access_token"),E=c.Z.get("user_data");if((0,s.useEffect)(()=>{a(!0),O&&E||e.replace("/")},[O,E,e]),(0,s.useEffect)(()=>{r&&O&&E&&(async()=>{try{let[e,r]=await Promise.all([n(),m()]);(null==e?void 0:e.length)>0&&N(e),(null==r?void 0:r.length)>0&&j(r)}catch(e){console.error("Error fetching options:",e)}finally{I(!1)}})()},[r,O,E]),!r||!O||!E)return null;if(v)return(0,t.jsx)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-gray-50 to-gray-100",children:(0,t.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading options..."})]})})});let B=e=>{let{name:r,value:a}=e.target;k(e=>({...e,[r]:"preferredLocationId"===r?a?Number(a):0:a})),x[r]&&b(e=>({...e,[r]:""}))},L=e=>{k(r=>({...r,programmingSkills:r.programmingSkills.includes(e)?r.programmingSkills.filter(r=>r!==e):[...r.programmingSkills,e]})),x.programmingSkills&&b(e=>({...e,programmingSkills:""}))},F=async e=>{e.preventDefault(),h(!0),b({});try{let e=c.Z.get("user_data");if(!e)throw new d("User data not found",401,"/user/register");let r=JSON.parse(e),a={...w,preferredLocationId:Number(w.preferredLocationId),programmingSkills:w.programmingSkills.map(e=>Number(e))},t=f(y,S).parse(a),s=await u(r.id,t);if(s.success){c.Z.set("user_data",JSON.stringify(s.data),{secure:!0,sameSite:"strict",path:"/"}),c.Z.set("userRegistered","true",{secure:!0,sameSite:"strict",path:"/"}),window.location.href="/user";return}b({fullName:s.message||"Registration failed. Please try again."})}catch(e){if(e instanceof i.z.ZodError){let r={};e.errors.forEach(e=>{let[a]=e.path;r[a]=e.message}),b(r)}else if(e instanceof d){if(401===e.status){window.location.href="/";return}b({fullName:e.message})}else b({fullName:"An unexpected error occurred. Please try again."})}finally{h(!1)}};return(0,t.jsx)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-gray-50 to-gray-100",children:(0,t.jsx)("main",{className:"flex-grow container mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-blue-600 px-6 py-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Complete Your Profile"}),(0,t.jsx)("p",{className:"text-blue-100 mt-2",children:"Please provide your information to continue"})]}),(0,t.jsxs)("form",{onSubmit:F,className:"p-6 space-y-6",role:"form",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),(0,t.jsx)("input",{id:"fullName",name:"fullName",type:"text",required:!0,value:w.fullName,onChange:B,className:"block w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20",placeholder:"Enter your full name"}),x.fullName&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:x.fullName})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{htmlFor:"dateOfBirth",className:"block text-sm font-medium text-gray-700",children:"Date of Birth"}),(0,t.jsx)("input",{id:"dateOfBirth",name:"dateOfBirth",type:"date",required:!0,value:w.dateOfBirth,onChange:B,className:"block w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20"}),x.dateOfBirth&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:x.dateOfBirth})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{htmlFor:"resumeSummary",className:"block text-sm font-medium text-gray-700",children:"Resume Summary"}),(0,t.jsx)("textarea",{id:"resumeSummary",name:"resumeSummary",required:!0,value:w.resumeSummary,onChange:B,rows:4,className:"block w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20",placeholder:"Brief summary of your professional background"}),x.resumeSummary&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:x.resumeSummary})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{htmlFor:"preferredLocationId",className:"block text-sm font-medium text-gray-700",children:"Preferred Location"}),(0,t.jsxs)("select",{id:"preferredLocationId",name:"preferredLocationId",required:!0,value:w.preferredLocationId||"",onChange:B,className:"block w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900  focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20",children:[(0,t.jsx)("option",{value:"",children:"Select a location"}),null==y?void 0:y.map(e=>(0,t.jsx)("option",{value:e.id,children:e.locationName},e.id))]}),x.preferredLocationId&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:x.preferredLocationId})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Programming Skills"}),(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 mt-2",children:null==S?void 0:S.map(e=>(0,t.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:w.programmingSkills.includes(e.id),onChange:()=>L(e.id),className:"rounded border-gray-300 text-blue-600  focus:ring-blue-500 focus:ring-offset-0"}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},e.id))}),x.programmingSkills&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:x.programmingSkills})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)("label",{htmlFor:"profileImage",className:"block text-sm font-medium text-gray-700",children:"Profile Image"}),(0,t.jsx)("input",{id:"profileImage",name:"profileImage",type:"file",accept:"image/*",onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(a){if(a.size>5242880){b(e=>({...e,profileImage:"File size must be less than 5MB"}));return}if(!a.type.startsWith("image/")){b(e=>({...e,profileImage:"Please upload an image file"}));return}k(e=>({...e,profileImage:a})),x.profileImage&&b(e=>({...e,profileImage:""}))}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),x.profileImage&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:x.profileImage}),w.profileImage&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Selected file: ",w.profileImage.name]})]}),(0,t.jsx)("div",{className:"pt-6",children:(0,t.jsx)("button",{type:"submit",disabled:p,className:"w-full inline-flex justify-center items-center py-3 px-6 border border-transparent  rounded-lg shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700  focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):"Complete Registration"})})]})]})})})})}}},function(e){e.O(0,[229,971,117,744],function(){return e(e.s=5762)}),_N_E=e.O()}]);